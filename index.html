<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poppy üå± | Mood Plant Dance</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#111a33;
      --card:#0f1730cc;
      --text:#eaf0ff;
      --muted:#b9c7ff;
      --accent:#7cf7b2;
      --accent2:#8aa4ff;
      --warn:#ffd18a;
      --danger:#ff8aa1;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(122,249,184,.16), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(138,164,255,.18), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }

    .wrap{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
    }
    @media (max-width: 880px){ .wrap{grid-template-columns:1fr} }

    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-color: rgba(124,247,178,.12);
      border-top-color: rgba(138,164,255,.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    header{
      padding:18px 18px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .title{display:flex;flex-direction:column;gap:6px}
    h1{font-size: clamp(18px, 2.6vw, 24px);line-height:1.15;margin:0;letter-spacing:.2px}
    .sub{margin:0;color: var(--muted);font-size: 13px}

    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 12px;color: var(--muted);
      user-select:none;white-space:nowrap;
    }
    .badge .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(124,247,178,.10);
    }

    .stage{padding: 14px 18px 18px;display:grid;gap:14px}

    .plantArea{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.08);
      background:
        radial-gradient(480px 260px at 50% 35%, rgba(124,247,178,.16), transparent 60%),
        radial-gradient(520px 260px at 50% 55%, rgba(138,164,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.10));
      height: 390px;
      position:relative;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 10px;
    }

    .floorGlow{
      position:absolute;
      bottom:-60px;
      width: 560px;
      height: 240px;
      border-radius: 999px;
      background: radial-gradient(circle at 50% 35%, rgba(124,247,178,.25), transparent 62%);
      filter: blur(2px);
      opacity:.85;
      pointer-events:none;
    }

    .speech{
      position:absolute;
      top: 14px;
      left: 14px;
      right: 14px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      pointer-events:none;
    }
    .bubble{
      max-width: 74%;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(6px);
      font-size: 13px;
      color: var(--text);
      line-height: 1.25;
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
    }
    .chip{
      padding: 9px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .chip b{color:var(--text)}

    .disco{
      position:absolute;
      inset:-20px;
      opacity:0;
      pointer-events:none;
      background:
        radial-gradient(280px 200px at 20% 10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(240px 200px at 80% 25%, rgba(124,247,178,.18), transparent 60%),
        radial-gradient(260px 220px at 50% 80%, rgba(138,164,255,.16), transparent 60%);
      mix-blend-mode: screen;
      transform: rotate(0deg);
    }

    /* ===== POPPY PLANT ===== */
    .plantWrap{
      position:relative;
      width: 300px;
      height: 330px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      transform-origin: 50% 95%;
    }

    .nameTag{
      position:absolute;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.18));
      color: var(--text);
      font-weight: 900;
      letter-spacing: .8px;
      text-transform: uppercase;
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
      user-select:none;
    }

    .plantBody{
      position:absolute;
      bottom: 118px;
      width: 250px;
      height: 190px;
      display:flex;
      align-items:center;
      justify-content:center;
      transform-origin: 50% 100%;
    }

    .stem{
      position:absolute;
      bottom: 0;
      width: 18px;
      height: 132px;
      border-radius: 999px;
      background: linear-gradient(180deg, #b9ffd9, #35e68f);
      box-shadow: 0 12px 25px rgba(45,220,126,.18);
    }

    .leaf{
      position:absolute;
      width: 128px;
      height: 76px;
      border-radius: 76px 76px 76px 18px;
      background:
        radial-gradient(circle at 25% 30%, rgba(255,255,255,.28), transparent 55%),
        linear-gradient(180deg, #c7ffe3, #42f1a0);
      border: 1px solid rgba(0,0,0,.08);
      filter: drop-shadow(0 14px 14px rgba(0,0,0,.20));
      transform-origin: 18% 80%;
    }
    .leaf::after{
      content:"";
      position:absolute;
      left: 22px;
      top: 14px;
      width: 62px;
      height: 44px;
      border-left: 2px solid rgba(0,0,0,.12);
      border-bottom: 2px solid rgba(0,0,0,.08);
      border-radius: 0 0 0 22px;
      transform: rotate(-12deg);
      opacity:.6;
    }

    .leafA{ left: 18px; bottom: 34px; transform: rotate(-18deg) scaleX(-1); }
    .leafB{ right: 18px; bottom: 26px; transform: rotate(16deg); }
    .leafC{
      width: 98px; height: 58px;
      bottom: 100px; left: 50%;
      transform: translateX(-50%) rotate(6deg);
      border-radius: 58px 58px 58px 18px;
      opacity: .98;
    }

    .face{
      position:absolute;
      bottom: 58px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 82px;
      border-radius: 26px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(8px);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:16px;
      padding-top:10px;
      box-shadow: 0 14px 26px rgba(0,0,0,.25);
    }
    .eye{
      width: 14px; height: 14px;
      border-radius: 999px;
      background: #0b1020;
      box-shadow: 0 0 0 6px rgba(255,255,255,.10);
      position:relative;overflow:hidden;
    }
    .eye:after{
      content:"";
      position:absolute;
      width: 6px;height:6px;border-radius:999px;
      background: rgba(255,255,255,.85);
      top: 2px; left: 2px;
    }
    .mouth{
      position:absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: 34px;
      height: 18px;
      border: 3px solid rgba(11,16,32,.92);
      border-top: none;
      border-radius: 0 0 24px 24px;
      background: transparent;
    }

    .brow{
      position:absolute;
      top: 10px;
      width: 22px;
      height: 6px;
      border-radius: 999px;
      background: rgba(11,16,32,.92);
      opacity:0;
    }
    .brow.left{ left: 24px; transform: rotate(-10deg); }
    .brow.right{ right: 24px; transform: rotate(10deg); }

    /* Mood faces */
    .mood-happy .mouth{ width: 42px; height: 22px; border-radius: 0 0 28px 28px; }
    .mood-sad .mouth{
      bottom: 18px;
      width: 42px; height: 18px;
      border-top: 3px solid rgba(11,16,32,.92);
      border-bottom:none;
      border-radius: 28px 28px 0 0;
    }
    .mood-silly .mouth{
      width: 18px; height: 18px;
      border: 3px solid rgba(11,16,32,.92);
      border-radius: 999px;
    }
    .mood-tired .mouth{
      width: 30px; height: 6px;
      border: none;
      background: rgba(11,16,32,.92);
      border-radius: 999px;
    }
    .mood-angry .mouth{
      width: 34px; height: 16px;
      border-top: 3px solid rgba(11,16,32,.92);
      border-bottom:none;
      border-radius: 20px 20px 0 0;
    }
    .mood-angry .brow{ opacity:1; }
    .mood-angry .brow.left{ transform: rotate(18deg); }
    .mood-angry .brow.right{ transform: rotate(-18deg); }
    .mood-tired .eye{ height: 10px; }

    /* Pot */
    .pot{
      width: 210px;
      height: 150px;
      position:relative;
      filter: drop-shadow(0 20px 34px rgba(0,0,0,.40));
    }
    .potRim{
      position:absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 34px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(0,0,0,.10));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 -10px 18px rgba(0,0,0,.22);
    }
    .soil{
      position:absolute;
      top: 10px;
      left: 22px;
      right: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #3b2a1f, #1d120c);
      border: 1px solid rgba(0,0,0,.18);
      opacity:.95;
    }
    .potBody{
      position:absolute;
      top: 18px;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 18px 18px 28px 28px;
      background: linear-gradient(180deg, #2b345b, #12162f);
      border: 1px solid rgba(255,255,255,.10);
    }

    /* Sparks */
    .spark{
      position:absolute;
      width: 10px; height: 10px;
      border-radius: 3px;
      background: rgba(255,255,255,.9);
      opacity:0;
      top: 40%;
      left: 50%;
      transform: translate(-50%,-50%);
      pointer-events:none;
    }

    /* ===== Controls ===== */
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 560px){ .controls{grid-template-columns:1fr} }

    .panel{
      padding: 14px 14px 16px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
    }

    label{display:block;font-size: 12px;color: var(--muted);margin-bottom: 7px}

    select, input[type="range"], button, textarea{
      width:100%;
      font: inherit;
      color: var(--text);
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 10px 12px;
      outline:none;
    }
    select:focus, button:focus, textarea:focus{
      border-color: rgba(124,247,178,.38);
      box-shadow: 0 0 0 4px rgba(124,247,178,.12);
    }

    .row{display:flex;gap:10px;align-items:center}
    .row > *{flex:1}

    .btn{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(124,247,178,.22), rgba(124,247,178,.08));
      transition: transform .08s ease, filter .2s ease, border-color .2s ease;
      font-weight: 650;
    }
    .btn:hover{ filter: brightness(1.06); border-color: rgba(124,247,178,.35);}
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.secondary{ background: linear-gradient(180deg, rgba(138,164,255,.18), rgba(138,164,255,.06)); }

    .readout{
      display:flex;justify-content:space-between;align-items:center;
      gap:10px;margin-top: 10px;font-size: 12px;color: var(--muted);
    }
    .meter{
      height: 10px;border-radius: 999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;flex:1;
    }
    .meter > span{
      display:block;height:100%;width: 55%;
      background: linear-gradient(90deg, rgba(124,247,178,.85), rgba(138,164,255,.85));
    }

    .hint{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px dashed rgba(255,255,255,.18);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
      background: rgba(255,255,255,.03);
    }
    .kbd{
      display:inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-weight: 800;
      font-size: 11px;
      transform: translateY(-1px);
    }

    /* RIGHT PANEL */
    .side{padding: 16px 16px 18px}
    .side h2{margin:0 0 6px;font-size: 16px}
    .side p{margin:0 0 14px;color: var(--muted);font-size: 13px;line-height: 1.4}

    .log{
      height: 230px;overflow:auto;
      padding: 12px;border-radius: 14px;
      background: rgba(0,0,0,.16);
      border:1px solid rgba(255,255,255,.10);
      font-size: 12px;color: var(--muted);line-height: 1.45;
    }
    .log b{color:var(--text)}
    .log .item{margin-bottom:10px}

    /* ===== Animations ===== */
    @keyframes wiggle {
      0%{ transform: rotate(0deg) translateY(0) }
      15%{ transform: rotate(-10deg) translateY(-1px) }
      35%{ transform: rotate(12deg) translateY(-2px) }
      55%{ transform: rotate(-8deg) translateY(-1px) }
      75%{ transform: rotate(10deg) translateY(-2px) }
      100%{ transform: rotate(0deg) translateY(0) }
    }
    @keyframes bounce {
      0%,100%{ transform: translateY(0) }
      25%{ transform: translateY(-16px) }
      55%{ transform: translateY(0) }
      75%{ transform: translateY(-8px) }
    }
    @keyframes discoSpin { 0%{ transform: rotate(0deg) } 100%{ transform: rotate(360deg) } }
    @keyframes headBob {
      0%,100%{ transform: translateX(-50%) translateY(0) }
      25%{ transform: translateX(-50%) translateY(-3px) }
      50%{ transform: translateX(-50%) translateY(2px) }
      75%{ transform: translateX(-50%) translateY(-2px) }
    }
    @keyframes sparkPop {
      0%{ opacity:0; transform: translate(-50%,-50%) scale(.3) rotate(0deg) }
      20%{ opacity:1 }
      100%{ opacity:0; transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1.2) rotate(220deg) }
    }
    @keyframes wilt {
      0%{ transform: rotate(0deg) translateY(0) }
      60%{ transform: rotate(-14deg) translateY(8px) }
      100%{ transform: rotate(-10deg) translateY(6px) }
    }
    @keyframes panicShake {
      0%{ transform: translateX(0) rotate(0deg) }
      10%{ transform: translateX(-6px) rotate(-3deg) }
      20%{ transform: translateX(6px) rotate(3deg) }
      30%{ transform: translateX(-5px) rotate(-2deg) }
      40%{ transform: translateX(5px) rotate(2deg) }
      50%{ transform: translateX(-4px) rotate(-1deg) }
      60%{ transform: translateX(4px) rotate(1deg) }
      70%{ transform: translateX(-3px) rotate(-1deg) }
      80%{ transform: translateX(3px) rotate(1deg) }
      90%{ transform: translateX(-2px) rotate(0deg) }
      100%{ transform: translateX(0) rotate(0deg) }
    }

    .dance-wiggle .plantWrap{ animation: wiggle 900ms ease-in-out infinite; }
    .dance-bounce .plantWrap{ animation: bounce 900ms ease-in-out infinite; }
    .dance-disco .plantWrap{ animation: wiggle 720ms ease-in-out infinite; }
    .dance-disco .disco{ opacity:1; animation: discoSpin 2.2s linear infinite; }
    .dance-wilt .plantWrap{ animation: wilt 1.2s ease-in-out infinite; }
    .dance-panic .plantWrap{ animation: panicShake 520ms linear infinite; }

    .dance-wiggle .face,
    .dance-bounce .face,
    .dance-disco .face,
    .dance-panic .face{
      animation: headBob 700ms ease-in-out infinite;
    }

    @media (prefers-reduced-motion: reduce){
      .dance-wiggle .plantWrap,
      .dance-bounce .plantWrap,
      .dance-disco .plantWrap,
      .dance-wilt .plantWrap,
      .dance-panic .plantWrap,
      .dance-wiggle .face,
      .dance-bounce .face,
      .dance-disco .face,
      .dance-panic .face,
      .dance-disco .disco{ animation:none !important; }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <!-- LEFT -->
    <section class="card" id="app">
      <header>
        <div class="title">
          <h1>Poppy üå±</h1>
          <p class="sub">A virtual plant that responds to your mood with silly dance animations.</p>
        </div>
        <div class="badge" title="Single-file hackathon build">
          <span class="dot" id="statusDot"></span>
          <span id="statusText">ready to vibe</span>
        </div>
      </header>

      <div class="stage">
        <div class="plantArea" id="plantArea">
          <div class="speech">
            <div class="bubble" id="bubble">I‚Äôm Poppy üå± Tell me your mood and I‚Äôll dance!</div>
            <div class="chip">
              mood: <b id="moodChip">happy</b> ¬∑ energy: <b id="energyChip">55</b>
            </div>
          </div>

          <div class="disco" id="disco"></div>
          <div class="floorGlow"></div>

          <!-- POPPY -->
          <div class="plantWrap" id="plantWrap" aria-label="Poppy the plant">
            <div class="nameTag" aria-hidden="true">Poppy</div>

            <div class="plantBody">
              <div class="stem"></div>
              <div class="leaf leafA"></div>
              <div class="leaf leafB"></div>
              <div class="leaf leafC"></div>

              <div class="face" id="face">
                <div class="brow left"></div>
                <div class="brow right"></div>
                <div class="eye"></div>
                <div class="eye"></div>
                <div class="mouth" id="mouth"></div>
              </div>
            </div>

            <div class="pot">
              <div class="potRim"></div>
              <div class="soil"></div>
              <div class="potBody"></div>
            </div>
          </div>

          <!-- sparks -->
          <div class="spark" id="spark1"></div>
          <div class="spark" id="spark2"></div>
          <div class="spark" id="spark3"></div>
        </div>

        <div class="controls">
          <div class="panel">
            <label for="moodSelect">Pick a mood</label>
            <select id="moodSelect">
              <option value="happy">Happy üòÑ</option>
              <option value="sad">Sad üò¢</option>
              <option value="stressed">Stressed üòµ‚Äçüí´</option>
              <option value="silly">Silly ü§™</option>
              <option value="angry">Angry üò†</option>
              <option value="tired">Tired üò¥</option>
              <option value="excited">Excited üéâ</option>
            </select>

            <div class="readout">
              <span>Energy</span>
              <div class="meter" aria-hidden="true"><span id="energyBar"></span></div>
              <span id="energyLabel">55</span>
            </div>
            <label for="energyRange" style="margin-top:10px;">Adjust energy</label>
            <input id="energyRange" type="range" min="0" max="100" value="55" />
          </div>

          <div class="panel">
            <label for="userText">Say something to Poppy</label>
            <textarea id="userText" rows="3" placeholder="e.g., I had a rough day..."></textarea>

            <div class="row" style="margin-top:10px;">
              <button class="btn" id="btnReact">React & Dance</button>
              <button class="btn secondary" id="btnRandom">Random Mood</button>
            </div>

            <div class="row" style="margin-top:10px;">
              <button class="btn secondary" id="btnSpark">Confetti Pop ‚ú®</button>
              <button class="btn secondary" id="btnStop">Stop Dancing</button>
            </div>

            <div class="hint">
              Tip: press <span class="kbd">R</span> for React ¬∑ <span class="kbd">C</span> for Confetti ¬∑ <span class="kbd">S</span> to Stop
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="card side">
      <h2>How it works</h2>
      <p>
        Pick a mood (or type a message). Poppy picks a goofy dance + a matching response.
        Higher energy makes it more chaotic.
      </p>

      <div class="log" id="log" aria-live="polite"></div>

      <div class="hint">
        Upgrade ideas: sentiment from text, unlock dances, friendship meter, mood history chart.
      </div>
    </aside>
  </main>

  <script>
    const app = document.getElementById('app');
    const plantArea = document.getElementById('plantArea');
    const face = document.getElementById('face');
    const bubble = document.getElementById('bubble');
    const moodChip = document.getElementById('moodChip');
    const energyChip = document.getElementById('energyChip');
    const moodSelect = document.getElementById('moodSelect');
    const energyRange = document.getElementById('energyRange');
    const energyLabel = document.getElementById('energyLabel');
    const energyBar = document.getElementById('energyBar');
    const userText = document.getElementById('userText');
    const log = document.getElementById('log');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');

    const sparks = [
      document.getElementById('spark1'),
      document.getElementById('spark2'),
      document.getElementById('spark3')
    ];

    const moods = ["happy","sad","stressed","silly","angry","tired","excited"];

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function setEnergy(val){
      const v = clamp(Number(val), 0, 100);
      energyRange.value = v;
      energyLabel.textContent = v;
      energyChip.textContent = v;
      energyBar.style.width = v + "%";
    }

    function clearDance(){
      app.classList.remove("dance-wiggle","dance-bounce","dance-disco","dance-wilt","dance-panic");
      statusDot.style.background = "var(--accent)";
      statusText.textContent = "ready to vibe";
    }

    function setMood(mood){
      face.classList.remove("mood-happy","mood-sad","mood-silly","mood-angry","mood-tired");
      const map = {
        happy: "mood-happy",
        excited: "mood-happy",
        stressed: "mood-tired",
        silly: "mood-silly",
        sad: "mood-sad",
        angry: "mood-angry",
        tired: "mood-tired"
      };
      face.classList.add(map[mood] || "mood-happy");
      moodChip.textContent = mood;
      moodSelect.value = mood;
    }

    function pickDance(mood, energy){
      if (mood === "sad") return energy > 55 ? "dance-wiggle" : "dance-wilt";
      if (mood === "tired") return energy > 65 ? "dance-panic" : "dance-wilt";
      if (mood === "angry") return energy > 50 ? "dance-panic" : "dance-wiggle";
      if (mood === "stressed") return energy > 60 ? "dance-panic" : "dance-bounce";
      if (mood === "silly") return energy > 45 ? "dance-disco" : "dance-wiggle";
      if (mood === "excited") return energy > 35 ? "dance-disco" : "dance-bounce";
      return energy > 50 ? "dance-bounce" : "dance-wiggle";
    }

    function responseLine(mood, energy, message){
      const msg = (message || "").trim();
      const hasMsg = msg.length > 0;

      const templates = {
        happy: [
          "I‚Äôm Poppy üå± and I‚Äôm photosynthesizing good vibes!",
          "Leaf me alone‚Ä¶ just kidding, dance time! üåø",
          "Mood detected. Initiating: happy wiggle üï∫"
        ],
        excited: [
          "WOO! I‚Äôm Poppy and I‚Äôm going FULL LEAF MODE ‚ú®",
          "Energy detected. Initiating: Wiggle Protocol 3000 üöÄüåø",
          "This is my favorite song (I made it up) üé∂"
        ],
        silly: [
          "I‚Äôm doing the worm, but like‚Ä¶ the leaf version ü§™",
          "Warning: extreme goofiness detected. Proceeding anyway.",
          "If you laugh, I grow 0.0001 inches."
        ],
        sad: [
          "I‚Äôm here. We can be droopy together for a minute üíö",
          "Small steps. Tiny dances.",
          "Sending a gentle leaf hug üåø"
        ],
        tired: [
          "Cozy sway time. No big moves. üò¥",
          "I‚Äôm running on dew and hope.",
          "Low battery. Still cute."
        ],
        angry: [
          "Okay‚Ä¶ channeling this into POWER DANCING üò§",
          "We‚Äôre turning steam into choreography.",
          "I‚Äôm not mad. I‚Äôm just‚Ä¶ vigorously leafy."
        ],
        stressed: [
          "Breathe in‚Ä¶ breathe out‚Ä¶ wiggle it out.",
          "I prescribe: 12 seconds of plant nonsense.",
          "Stress? I only know 'dress' (as in leaf dress)."
        ]
      };

      const list = templates[mood] || templates.happy;
      let line = list[Math.floor(Math.random()*list.length)];

      if (hasMsg){
        line += `\n\nI heard: ‚Äú${msg.slice(0, 120)}${msg.length > 120 ? "‚Ä¶" : ""}‚Äù`;
      }

      if (energy >= 80) line += "\n\nEnergy level: MAXIMUM CHAOS ‚úÖ";
      if (energy <= 20) line += "\n\nEnergy level: tiny wiggles only ü´∂";

      return line;
    }

    function logEvent(mood, dance, energy){
      const time = new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
      const danceName = {
        "dance-wiggle": "Wiggle",
        "dance-bounce": "Bounce",
        "dance-disco": "Disco",
        "dance-wilt": "Dramatic Wilt",
        "dance-panic": "Panic Shake"
      }[dance] || dance;

      const div = document.createElement('div');
      div.className = "item";
      div.innerHTML = `<b>${time}</b> ¬∑ mood=<b>${mood}</b> ¬∑ dance=<b>${danceName}</b> ¬∑ energy=<b>${energy}</b>`;
      log.prepend(div);
    }

    function setStatus(dance){
      statusText.textContent = dance.replace("dance-","").replace("-", " ");
      if (dance === "dance-wilt") statusDot.style.background = "var(--warn)";
      else if (dance === "dance-panic") statusDot.style.background = "var(--danger)";
      else if (dance === "dance-disco") statusDot.style.background = "var(--accent2)";
      else statusDot.style.background = "var(--accent)";
    }

    function react(){
      const mood = moodSelect.value;
      const energy = Number(energyRange.value);

      clearDance();
      setMood(mood);

      const dance = pickDance(mood, energy);
      app.classList.add(dance);
      setStatus(dance);

      bubble.textContent = responseLine(mood, energy, userText.value);
      logEvent(mood, dance, energy);

      if (dance === "dance-disco" || energy >= 85) sparkPop();
    }

    function sparkPop(){
      const rect = plantArea.getBoundingClientRect();
      const centerX = rect.width/2;
      const centerY = rect.height/2;

      sparks.forEach((s, i) => {
        const dx = (Math.random()*220 - 110) + "px";
        const dy = (Math.random()*220 - 110) + "px";
        s.style.setProperty("--dx", dx);
        s.style.setProperty("--dy", dy);

        s.style.opacity = 0;
        s.style.left = (centerX + (Math.random()*40-20)) + "px";
        s.style.top  = (centerY + (Math.random()*40-20)) + "px";

        s.style.animation = "none";
        void s.offsetWidth;
        s.style.animation = `sparkPop 700ms ease-out ${i*70}ms 1`;
      });
    }

    function randomMood(){
      const mood = moods[Math.floor(Math.random()*moods.length)];
      moodSelect.value = mood;
      const e = clamp(Number(energyRange.value) + (Math.random()*30 - 15), 0, 100);
      setEnergy(Math.round(e));
      react();
    }

    document.getElementById('btnReact').addEventListener('click', react);
    document.getElementById('btnRandom').addEventListener('click', randomMood);
    document.getElementById('btnSpark').addEventListener('click', sparkPop);
    document.getElementById('btnStop').addEventListener('click', () => {
      clearDance();
      bubble.textContent = "Okay, pausing the groove. When you‚Äôre ready, tell Poppy your mood üåø";
    });

    moodSelect.addEventListener('change', () => setMood(moodSelect.value));
    energyRange.addEventListener('input', (e) => setEnergy(e.target.value));

    window.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'r') react();
      if (e.key.toLowerCase() === 'c') sparkPop();
      if (e.key.toLowerCase() === 's') clearDance();
    });

    // init
    setMood("happy");
    setEnergy(55);
    log.innerHTML = `<div class="item"><b>Welcome</b> ¬∑ Poppy is ready. Pick a mood and hit <b>React & Dance</b>.</div>`;
  </script>
</body>
</html>
